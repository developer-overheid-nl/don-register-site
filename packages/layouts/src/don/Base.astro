---
import "../styles/reset.css";
import "../../../../proprietary/fonts/ro/index.css";
import "@rijkshuisstijl-community/design-tokens/dist/uitvoerend-groen/root.css";
import "@rijkshuisstijl-community/components-css/dist/index.css";
import "../styles/override.css";
import "../styles/helpers.css";
import {
  Container,
  Footer,
  Header,
  IconsSprite,
  TopNavigation,
} from "@developer-overheid-nl/don-register-components";
import resources from "@developer-overheid-nl/don-register-locales/nl" with {
  type: "json",
};
import i18next from "i18next";

const {
  appConfig: { title: titleSite, mainSite, urlHomepage, topNavigation, footer },
  titlePage,
} = Astro.props;
const { routePattern } = Astro;
const defaultMatomoUrl = "https://overheid.matomo.cloud/";
const defaultMatomoScriptUrl =
  "https://cdn.matomo.cloud/overheid.matomo.cloud/matomo.js";
const defaultMatomoSiteId = "2";
const matomoUrl = import.meta.env.PUBLIC_MATOMO_URL || defaultMatomoUrl;
const matomoScriptUrl =
  import.meta.env.PUBLIC_MATOMO_SCRIPT_URL || defaultMatomoScriptUrl;
const matomoSiteId =
  import.meta.env.PUBLIC_MATOMO_SITE_ID || defaultMatomoSiteId;
const matomoEnabled = Boolean(matomoUrl && matomoScriptUrl && matomoSiteId);
const shouldRenderMatomo = matomoEnabled && !import.meta.env.DEV;

i18next.init({
  // Right now we are using the locales directly, but in the future we can use the i18next-fs-backend to load them from files
  // We also have just one language. Refactor this when we have more languages.
  lng: "nl",
  fallbackLng: "nl",
  resources: {
    nl: {
      translation: resources,
    },
  },
});
---

<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={ i18next.t('layouts.meta-description') } />
    <title>{titlePage} | {titleSite}</title>
    <slot name="head" />
    {shouldRenderMatomo && (
      <>
        <script
          is:inline
          define:vars={{ matomoUrl, matomoSiteId, matomoScriptUrl }}
        >
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function(){
            var u = matomoUrl;
            _paq.push(["setTrackerUrl", u + "matomo.php"]);
            _paq.push(["setSiteId", matomoSiteId]);
            var d = document, g = d.createElement("script"), s = d.getElementsByTagName("script")[0];
            g.async = true; g.src = matomoScriptUrl; s.parentNode.insertBefore(g, s);
          })();
        </script>
      </>
    )}
  </head>
  <body class="utrecht-document don-document">
    <div class="don-document-start">
      <slot name="body-start" />
      <IconsSprite />
    </div>
    <div class="don-document-header">
    <Container>
      <Header titleSite={titleSite} titlePage={titlePage} mainSite={mainSite} urlCurrent={routePattern} urlHomepage={urlHomepage} logoLinkBehaviour='main-site-on-home' />
    </Container>
    <TopNavigation items={topNavigation.items} endItems={topNavigation.endItems} />
    </div>
    <main class="don-document-main">
      <slot />
    </main>
    <div class="don-document-footer">
      <Footer columns={footer.columns} />
    </div>
    <div class="don-document-end">
      <slot name="body-end" />
    </div>
  </body>
</html>

<style>
  .don-document {
    height: 100dvh;
    display: grid;
    grid-template-rows: [start-start] 0 [start-end 
                        header-start] auto [header-end 
                        main-start] 1fr [main-end 
                        footer-start] auto [footer-end 
                        end-start] 0 [end-end];
    grid-template-columns: [start-start header-start main-start footer-start end-start] auto [end-end footer-end main-end header-end start-end];
    grid-auto-rows: 0;
  }

  .don-document-start {
    grid-area: start;
  }

  .don-document-header {
    grid-area: header;
  }

  .don-document-main {
    grid-area: main;
  }

  .don-document-footer {
    grid-area: footer;
  }

  .don-document-end {
    grid-area: end;
  }
</style>
